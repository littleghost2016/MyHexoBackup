<!DOCTYPE html>


  <html class="light page-post">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>现代密码学上机作业 | LittleGhost&#39;s Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="密码学,">
  

  <meta name="description" content="实现RSA算法实验摘要利用Python实现RSA的公钥加密、私钥解密过程，运用了扩展欧几里得算法求乘法逆元。RSA利用了大素数分解的数学困难问题，同时用于加密和数字签名的算法。 实验过程RSA加密过程：通过选取的随机大素数p和q计算n和n的欧拉函数f_n，选取e作为加密时的指数，将明文m转换成数字计算m**e(mod n)转换成字母得密文c。 RSA解密过程：计算e在模f_n下的乘法逆元d，将密文">
<meta name="keywords" content="密码学">
<meta property="og:type" content="article">
<meta property="og:title" content="现代密码学上机作业">
<meta property="og:url" content="https://littleghost2016.github.io/2018/01/02/现代密码学上机作业/index.html">
<meta property="og:site_name" content="LittleGhost&#39;s Blog">
<meta property="og:description" content="实现RSA算法实验摘要利用Python实现RSA的公钥加密、私钥解密过程，运用了扩展欧几里得算法求乘法逆元。RSA利用了大素数分解的数学困难问题，同时用于加密和数字签名的算法。 实验过程RSA加密过程：通过选取的随机大素数p和q计算n和n的欧拉函数f_n，选取e作为加密时的指数，将明文m转换成数字计算m**e(mod n)转换成字母得密文c。 RSA解密过程：计算e在模f_n下的乘法逆元d，将密文">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://littleghost2016.github.io/2018/01/02/现代密码学上机作业/image-20200401190010113.png">
<meta property="og:image" content="https://littleghost2016.github.io/2018/01/02/现代密码学上机作业/image-20200401190044716.png">
<meta property="og:image" content="https://littleghost2016.github.io/2018/01/02/现代密码学上机作业/image-20200401190051719.png">
<meta property="og:image" content="https://littleghost2016.github.io/2018/01/02/现代密码学上机作业/image-20200401190116841.png">
<meta property="og:image" content="https://littleghost2016.github.io/2018/01/02/现代密码学上机作业/image-20200401190353179.png">
<meta property="og:image" content="https://littleghost2016.github.io/2018/01/02/现代密码学上机作业/image-20200401190423849.png">
<meta property="og:updated_time" content="2020-04-01T12:12:31.621Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="现代密码学上机作业">
<meta name="twitter:description" content="实现RSA算法实验摘要利用Python实现RSA的公钥加密、私钥解密过程，运用了扩展欧几里得算法求乘法逆元。RSA利用了大素数分解的数学困难问题，同时用于加密和数字签名的算法。 实验过程RSA加密过程：通过选取的随机大素数p和q计算n和n的欧拉函数f_n，选取e作为加密时的指数，将明文m转换成数字计算m**e(mod n)转换成字母得密文c。 RSA解密过程：计算e在模f_n下的乘法逆元d，将密文">
<meta name="twitter:image" content="https://littleghost2016.github.io/2018/01/02/现代密码学上机作业/image-20200401190010113.png">

  

  
    <link rel="icon" href="https://avatars2.githubusercontent.com/u/22980536?s=460&v=4">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  

  


  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

</head>
</html>
<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            文章
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于我
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#实现RSA算法"><span class="toc-text">实现RSA算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实验摘要"><span class="toc-text">实验摘要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验过程"><span class="toc-text">实验过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码"><span class="toc-text">代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python3"><span class="toc-text">Python3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C"><span class="toc-text">C</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验总结"><span class="toc-text">实验总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现SM2加密算法。给出“we-are-student”的加解密变换结果"><span class="toc-text">实现SM2加密算法。给出“we are student”的加解密变换结果</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实验摘要-1"><span class="toc-text">实验摘要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码-1"><span class="toc-text">代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python3-1"><span class="toc-text">Python3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验总结-1"><span class="toc-text">实验总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-text">参考文献</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现SM2签名算法。给出“we-are-student”的签名。"><span class="toc-text">实现SM2签名算法。给出“we are student”的签名。</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实验摘要-2"><span class="toc-text">实验摘要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码-2"><span class="toc-text">代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python3-2"><span class="toc-text">Python3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验总结-2"><span class="toc-text">实验总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现SM3算法"><span class="toc-text">实现SM3算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实验摘要-3"><span class="toc-text">实验摘要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码-3"><span class="toc-text">代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python3-3"><span class="toc-text">Python3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验总结-3"><span class="toc-text">实验总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献-1"><span class="toc-text">参考文献</span></a></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-现代密码学上机作业" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">现代密码学上机作业</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2018.01.02</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>LittleGhost</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/技术/">技术</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h1 id="实现RSA算法"><a href="#实现RSA算法" class="headerlink" title="实现RSA算法"></a>实现RSA算法</h1><h2 id="实验摘要"><a href="#实验摘要" class="headerlink" title="实验摘要"></a>实验摘要</h2><p>利用Python实现RSA的公钥加密、私钥解密过程，运用了扩展欧几里得算法求乘法逆元。RSA利用了大素数分解的数学困难问题，同时用于加密和<a href="https://baike.baidu.com/item/数字签名" target="_blank" rel="noopener">数字签名</a>的算法。</p>
<h2 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h2><p>RSA加密过程：通过选取的随机大素数p和q计算n和n的欧拉函数f_n，选取e作为加密时的指数，将明文m转换成数字计算m**e(mod n)转换成字母得密文c。</p>
<p>RSA解密过程：计算e在模f_n下的乘法逆元d，将密文c转换成数字计算c**d(mod n)转换成字母得明文m。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="Python3"><a href="#Python3" class="headerlink" title="Python3"></a>Python3</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RSA</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">0</span></span><br><span class="line">        self.f_n = <span class="number">0</span></span><br><span class="line">        self.e = <span class="number">0</span></span><br><span class="line">        self.display_list = []</span><br><span class="line">        self.display_str = <span class="string">''</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">(self)</span>:</span></span><br><span class="line">        p = <span class="number">2269</span></span><br><span class="line">        q = <span class="number">1427</span></span><br><span class="line">        self.n = p * q</span><br><span class="line">        self.f_n =(p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">        self.e = <span class="number">4271</span></span><br><span class="line">        <span class="comment"># 4271</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            func_choice = int(input(<span class="string">'加密请输入1，解密请输入2：'</span>))</span><br><span class="line">            <span class="keyword">if</span> func_choice == <span class="number">1</span>:</span><br><span class="line">                self.display_str = input(<span class="string">'求输入想进行操作的字符串：'</span>)</span><br><span class="line">                self.encrypt()</span><br><span class="line">            <span class="keyword">elif</span> func_choice == <span class="number">2</span>:</span><br><span class="line">                self.display_list = input(<span class="string">'求输入密文，用英文逗号隔开，不需要输入中括号：'</span>).replace(<span class="string">' '</span>, <span class="string">''</span>).split(<span class="string">','</span>)</span><br><span class="line">                self.decrypt()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'你输入了错误的选项！'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.display_list = []</span><br><span class="line">        str_b64 = base64.b64encode(bytes(self.display_str, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line">        list_b64 = list(str_b64)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> list_b64:</span><br><span class="line">            self.display_list.append((i ** self.e) % self.n)</span><br><span class="line">        print(<span class="string">'密文为：'</span>, self.display_list)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.display_str = <span class="string">''</span></span><br><span class="line">        temp_list = []</span><br><span class="line">        d = self.createPrivateKey()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.display_list:</span><br><span class="line">            temp_list.append(chr((int(i) ** d) % self.n))</span><br><span class="line">        self.display_str = base64.b64decode(<span class="string">''</span>.join(temp_list)).decode()</span><br><span class="line">        print(<span class="string">'明文为：'</span>, self.display_str)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createPrivateKey</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 产生私钥d</span></span><br><span class="line">        temp = self.egcd(self.e, self.f_n)[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">while</span> temp &lt; <span class="number">0</span>:</span><br><span class="line">            temp += self.f_n</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">egcd</span><span class="params">(self, a, b)</span>:</span></span><br><span class="line">        <span class="comment"># 扩展欧几里得算法</span></span><br><span class="line">        <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> a, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            g, x, y = self.egcd(b, a % b)</span><br><span class="line">            <span class="keyword">return</span> g, y, x - a // b * y</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    rsa = RSA()</span><br><span class="line">    rsa.work()</span><br></pre></td></tr></table></figure>

<p><img src="image-20200401190010113.png" alt="image-20200401190010113"></p>
<h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p, q, n, n2, e, d, c, m, ch;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"请输入两个素数：\n"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;p, &amp;q);</span><br><span class="line">    n = p * q;</span><br><span class="line">    <span class="keyword">while</span> (judege(p) + judege(q)) <span class="comment">//不是素数 则报错</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"错误！输入两个数不是素数"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    n2 = (p - <span class="number">1</span>) * (q - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"请选择e,使得e与%d互素且小于%d且大于1：\n"</span>, n2, n2);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;e);</span><br><span class="line">    d = cald(e, n2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"根据e=%d计算d=%d\n"</span>, e, d);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"请选择1.加密 2.解密\n"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;ch);</span><br><span class="line">    <span class="keyword">switch</span> (ch)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"请输入你要加密的明文数字：\n"</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;m);</span><br><span class="line">        c = en(m, e, n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"得到的密文：%d\n"</span>, c);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"请输入你要解密的密文数字：\n"</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;m);</span><br><span class="line">        c = dn(m, d, n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"得到的明文：%d"</span>, c);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">judege</span><span class="params">(<span class="keyword">int</span> a)</span> <span class="comment">//判断输入的两个数是否是素数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">2</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; a; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (a % i == <span class="number">0</span>)</span><br><span class="line">            j = j + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j &gt;= <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cald</span><span class="params">(<span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> <span class="comment">//计算d</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; c; i++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((i * b) % c == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">en</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> <span class="comment">//加密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r, i;</span><br><span class="line">    r = a;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; b; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        r = r * a;</span><br><span class="line">        r = r % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dn</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> <span class="comment">//解密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r, i;</span><br><span class="line">    r = a;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; b; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        r = r * a;</span><br><span class="line">        r = r % c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20200401190044716.png" alt="image-20200401190044716"></p>
<p><img src="image-20200401190051719.png" alt="image-20200401190051719"></p>
<h2 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a>实验总结</h2><p>本程序实现完整RSA功能，注意问题及解决方案为以下几点：</p>
<ol>
<li>文字和数字之间的转换，因设计数学运算和文字阅读</li>
<li>模指数运算来加快运算速度</li>
<li>素数的选择不再算法本身要考虑的范围内</li>
</ol>
<h1 id="实现SM2加密算法。给出“we-are-student”的加解密变换结果"><a href="#实现SM2加密算法。给出“we-are-student”的加解密变换结果" class="headerlink" title="实现SM2加密算法。给出“we are student”的加解密变换结果"></a>实现SM2加密算法。给出“we are student”的加解密变换结果</h1><h2 id="实验摘要-1"><a href="#实验摘要-1" class="headerlink" title="实验摘要"></a>实验摘要</h2><p>根据国密推荐的SM2椭圆曲线公钥密码算法，首先产生随机数计算出曲线点C1，2个32byte的BigInteger大数，即为SM2加密结果的第1部分。第2部分则是真正的密文，是对明文的加密结果，长度和明文一样。第3部分是杂凑值，用来效验数据。按国密推荐的256位椭圆曲线，明文加密结果比原长度会大96byte。</p>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><h3 id="Python3-1"><a href="#Python3-1" class="headerlink" title="Python3"></a>Python3</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">import</span> SM3</span><br><span class="line"></span><br><span class="line">sm2_N = int(<span class="string">'FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFF7203DF6B21C6052B53BBF40939D54123'</span>, <span class="number">16</span>)</span><br><span class="line">sm2_P = int(<span class="string">'FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFF'</span>, <span class="number">16</span>)</span><br><span class="line">sm2_G = <span class="string">'32c4ae2c1f1981195f9904466a39c9948fe30bbff2660be1715a4589334c74c7bc3736a2f4f6779c59bdcee36b692153d0a9877cc62a474002df32e52139f0a0'</span>  <span class="comment"># G点</span></span><br><span class="line">sm2_a = int(<span class="string">'FFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00000000FFFFFFFFFFFFFFFC'</span>,<span class="number">16</span>)</span><br><span class="line">sm2_b = int(<span class="string">'28E9FA9E9D9F5E344D5A9E4BCF6509A7F39789F515AB8F92DDBCBD414D940E93'</span>,<span class="number">16</span>)</span><br><span class="line">sm2_a_3 = (sm2_a + <span class="number">3</span>) % sm2_P</span><br><span class="line">Fp = <span class="number">256</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sm2_N = int('BDB6F4FE3E8B1D9E0DA8C0D40FC962195DFAE76F56564677', 16)</span></span><br><span class="line"><span class="comment"># sm2_P = int('BDB6F4FE3E8B1D9E0DA8C0D46F4C318CEFE4AFE3B6B8551F', 16)</span></span><br><span class="line"><span class="comment"># sm2_G = '4AD5F7048DE709AD51236DE65E4D4B482C836DC6E410664002BB3A02D4AAADACAE24817A4CA3A1B014B5270432DB27D2'# G点</span></span><br><span class="line"><span class="comment"># sm2_a = int('BB8E5E8FBC115E139FE6A814FE48AAA6F0ADA1AA5DF91985',16)</span></span><br><span class="line"><span class="comment"># sm2_b = int('1854BEBDC31B21B7AEFC80AB0ECD10D5B1B3308E6DBF11C1',16)</span></span><br><span class="line"><span class="comment"># sm2_a_3 = (sm2_a + 3) % sm2_P</span></span><br><span class="line"><span class="comment"># Fp = 192</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_random_str</span><span class="params">(strlen)</span>:</span></span><br><span class="line">    letterlist = [<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>]</span><br><span class="line">    str = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(strlen):</span><br><span class="line">        a = choice(letterlist)</span><br><span class="line">        str = <span class="string">'%s%s'</span> % (str,a)</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kG</span><span class="params">(k, Point,len_para)</span>:</span>  <span class="comment"># kP运算</span></span><br><span class="line">    Point = <span class="string">'%s%s'</span> % (Point, <span class="string">'1'</span>)</span><br><span class="line">    mask_str = <span class="string">'8'</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len_para<span class="number">-1</span>):</span><br><span class="line">        mask_str += <span class="string">'0'</span></span><br><span class="line">    <span class="comment"># print(mask_str)</span></span><br><span class="line">    mask = int(mask_str, <span class="number">16</span>)</span><br><span class="line">    Temp = Point</span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(len_para * <span class="number">4</span>):</span><br><span class="line">        <span class="keyword">if</span> (flag):</span><br><span class="line">            Temp = DoublePoint(Temp,len_para)</span><br><span class="line">        <span class="keyword">if</span> (k &amp; mask) != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> (flag):</span><br><span class="line">                Temp = AddPoint(Temp, Point,len_para)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                Temp = Point</span><br><span class="line">        k = k &lt;&lt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ConvertJacb2Nor(Temp,len_para)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 倍点运算</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DoublePoint</span><span class="params">(Point,len_para)</span>:</span></span><br><span class="line">    l = len(Point)</span><br><span class="line">    len_2 = <span class="number">2</span> * len_para</span><br><span class="line">    <span class="keyword">if</span> l&lt; len_para*<span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x1 = int(Point[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">        y1 = int(Point[len_para:len_2], <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> l == len_2:</span><br><span class="line">            z1 = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            z1 = int(Point[len_2:], <span class="number">16</span>)</span><br><span class="line">        T6 = (z1 * z1) % sm2_P</span><br><span class="line">        T2 = (y1 * y1) % sm2_P</span><br><span class="line">        T3 = (x1 + T6) % sm2_P</span><br><span class="line">        T4 = (x1 - T6) % sm2_P</span><br><span class="line">        T1 = (T3 * T4) % sm2_P</span><br><span class="line">        T3 = (y1 * z1) % sm2_P</span><br><span class="line">        T4 = (T2 * <span class="number">8</span>) % sm2_P</span><br><span class="line">        T5 = (x1 * T4) % sm2_P</span><br><span class="line">        T1 = (T1 * <span class="number">3</span>) % sm2_P</span><br><span class="line">        T6 = (T6 * T6) % sm2_P</span><br><span class="line">        T6 = (sm2_a_3 * T6) % sm2_P</span><br><span class="line">        T1 = (T1 + T6) % sm2_P</span><br><span class="line">        z3 = (T3 + T3) % sm2_P</span><br><span class="line">        T3 = (T1 * T1) % sm2_P</span><br><span class="line">        T2 = (T2 * T4) % sm2_P</span><br><span class="line">        x3 = (T3 - T5) % sm2_P</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (T5 % <span class="number">2</span>) == <span class="number">1</span>:</span><br><span class="line">            T4 = (T5 + ((T5 + sm2_P) &gt;&gt; <span class="number">1</span>) - T3) % sm2_P</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            T4 = (T5 + (T5 &gt;&gt; <span class="number">1</span>) - T3) % sm2_P</span><br><span class="line"></span><br><span class="line">        T1 = (T1 * T4) % sm2_P</span><br><span class="line">        y3 = (T1 - T2) % sm2_P</span><br><span class="line"></span><br><span class="line">        form = <span class="string">'%%0%dx'</span> % len_para</span><br><span class="line">        form = form * <span class="number">3</span></span><br><span class="line">        <span class="keyword">return</span> form % (x3, y3, z3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 点加函数，P2点为仿射坐标即z=1，P1为Jacobian加重射影坐标</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AddPoint</span><span class="params">(P1, P2, len_para)</span>:</span></span><br><span class="line">    len_2 = <span class="number">2</span> * len_para</span><br><span class="line">    l1 = len(P1)</span><br><span class="line">    l2 = len(P2)</span><br><span class="line">    <span class="keyword">if</span> (l1 &lt; len_2) <span class="keyword">or</span> (l2 &lt; len_2):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        X1 = int(P1[<span class="number">0</span>: len_para], <span class="number">16</span>)</span><br><span class="line">        Y1 = int(P1[len_para: len_2], <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> (l1 == len_2):</span><br><span class="line">            Z1 = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Z1 = int(P1[len_2:], <span class="number">16</span>)</span><br><span class="line">        x2 = int(P2[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">        y2 = int(P2[len_para:len_2], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        T1 = (Z1 * Z1) % sm2_P</span><br><span class="line">        T2 = (y2 * Z1) % sm2_P</span><br><span class="line">        T3 = (x2 * T1) % sm2_P</span><br><span class="line">        T1 = (T1 * T2) % sm2_P</span><br><span class="line">        T2 = (T3 - X1) % sm2_P</span><br><span class="line">        T3 = (T3 + X1) % sm2_P</span><br><span class="line">        T4 = (T2 * T2) % sm2_P</span><br><span class="line">        T1 = (T1 - Y1) % sm2_P</span><br><span class="line">        Z3 = (Z1 * T2) % sm2_P</span><br><span class="line">        T2 = (T2 * T4) % sm2_P</span><br><span class="line">        T3 = (T3 * T4) % sm2_P</span><br><span class="line">        T5 = (T1 * T1) % sm2_P</span><br><span class="line">        T4 = (X1 * T4) % sm2_P</span><br><span class="line">        X3 = (T5 - T3) % sm2_P</span><br><span class="line">        T2 = (Y1 * T2) % sm2_P</span><br><span class="line">        T3 = (T4 - X3) % sm2_P</span><br><span class="line">        T1 = (T1 * T3) % sm2_P</span><br><span class="line">        Y3 = (T1 - T2) % sm2_P</span><br><span class="line"></span><br><span class="line">        form = <span class="string">'%%0%dx'</span> % len_para</span><br><span class="line">        form = form * <span class="number">3</span></span><br><span class="line">        <span class="keyword">return</span> form % (X3, Y3, Z3)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ConvertJacb2Nor</span><span class="params">(Point,len_para)</span>:</span> <span class="comment"># Jacobian加重射影坐标转换成仿射坐标</span></span><br><span class="line">    len_2 = <span class="number">2</span> * len_para</span><br><span class="line">    x = int(Point[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">    y = int(Point[len_para:len_2], <span class="number">16</span>)</span><br><span class="line">    z = int(Point[len_2:], <span class="number">16</span>)</span><br><span class="line">    <span class="comment"># z_inv = Inverse(z, P)</span></span><br><span class="line">    z_inv = pow(z, sm2_P - <span class="number">2</span>, sm2_P)</span><br><span class="line">    z_invSquar = (z_inv * z_inv) % sm2_P</span><br><span class="line">    z_invQube = (z_invSquar * z_inv) % sm2_P</span><br><span class="line">    x_new = (x * z_invSquar) % sm2_P</span><br><span class="line">    y_new = (y * z_invQube) % sm2_P</span><br><span class="line">    z_new = (z * z_inv) % sm2_P</span><br><span class="line">    <span class="keyword">if</span> z_new == <span class="number">1</span>:</span><br><span class="line">        form = <span class="string">'%%0%dx'</span> % len_para</span><br><span class="line">        form = form * <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> form % (x_new, y_new)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Convert Error'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可逆，可用pow()代替</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Inverse</span><span class="params">(data, M,len_para)</span>:</span></span><br><span class="line">    tempM = M - <span class="number">2</span></span><br><span class="line">    mask_str = <span class="string">'8'</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len_para - <span class="number">1</span>):</span><br><span class="line">        mask_str += <span class="string">'0'</span></span><br><span class="line">    mask = int(mask_str, <span class="number">16</span>)</span><br><span class="line">    tempA = <span class="number">1</span></span><br><span class="line">    tempB = data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len_para*<span class="number">4</span>):</span><br><span class="line">        tempA = (tempA * tempA) % M</span><br><span class="line">        <span class="keyword">if</span> (tempM &amp; mask) != <span class="number">0</span>:</span><br><span class="line">            tempA = (tempA * tempB) % M</span><br><span class="line">        mask = mask &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tempA</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验签函数，Sign签名r||s，E消息hash，PA公钥</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Verify</span><span class="params">(Sign, E, PA,len_para)</span>:</span></span><br><span class="line">    r = int(Sign[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">    s = int(Sign[len_para:<span class="number">2</span>*len_para], <span class="number">16</span>)</span><br><span class="line">    e = int(E, <span class="number">16</span>)</span><br><span class="line">    t = (r + s) % sm2_N</span><br><span class="line">    P1 = kG(s, sm2_G,len_para)</span><br><span class="line">    P2 = kG(t, PA,len_para)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> P1 == P2:</span><br><span class="line">        P1 = <span class="string">'%s%s'</span> % (P1, <span class="number">1</span>)</span><br><span class="line">        P1 = DoublePoint(P1,len_para)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        P1 = <span class="string">'%s%s'</span> % (P1, <span class="number">1</span>)</span><br><span class="line">        P1 = AddPoint(P1, P2,len_para)</span><br><span class="line">        P1 = ConvertJacb2Nor(P1,len_para)</span><br><span class="line"></span><br><span class="line">    x = int(P1[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> (r == ((e + x) % sm2_N))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 签名函数, E消息的hash，DA私钥，K随机数，均为16进制字符串</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Sign</span><span class="params">(E, DA, K,len_para)</span>:</span></span><br><span class="line">    e = int(E, <span class="number">16</span>)</span><br><span class="line">    d = int(DA, <span class="number">16</span>)</span><br><span class="line">    k = int(K, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    P1 = kG(k, sm2_G,len_para)</span><br><span class="line"></span><br><span class="line">    x = int(P1[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">    R = ((e + x) % sm2_N)</span><br><span class="line">    d_1 = pow(d+<span class="number">1</span>, sm2_N - <span class="number">2</span>, sm2_N)</span><br><span class="line">    S = (d_1*(k + R) - R) % sm2_N</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'%064x%064x'</span> % (R,S)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密函数，M消息，PA公钥</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Encrypt</span><span class="params">(M,PA,len_para,Hexstr = <span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> Hexstr:</span><br><span class="line">        msg = M <span class="comment"># 输入消息本身是16进制字符串</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg = SM3.str2byte(M)</span><br><span class="line">        msg = SM3.byte2hex(msg) <span class="comment"># 消息转化为16进制字符串</span></span><br><span class="line">    k = get_random_str(len_para)</span><br><span class="line">    <span class="comment"># k = '59276E27D506861A16680F3AD9C02DCCEF3CC1FA3CDBE4CE6D54B80DEAC1BC21'</span></span><br><span class="line">    <span class="comment"># k = '384F30353073AEECE7A1654330A96204D37982A3E15B2CB5'</span></span><br><span class="line">    C1 = kG(int(k, <span class="number">16</span>),sm2_G, len_para)</span><br><span class="line">    <span class="comment"># print('C1 = %s'%C1)</span></span><br><span class="line">    xy = kG(int(k, <span class="number">16</span>), PA, len_para)</span><br><span class="line">    <span class="comment"># print('xy = %s' % xy)</span></span><br><span class="line">    x2 = xy[<span class="number">0</span>:len_para]</span><br><span class="line">    y2 = xy[len_para:<span class="number">2</span> * len_para]</span><br><span class="line">    ml = len(msg)</span><br><span class="line">    <span class="comment"># print('ml = %d'% ml)</span></span><br><span class="line">    t = SM3.KDF(xy,ml / <span class="number">2</span>)</span><br><span class="line">    <span class="comment"># print(t)</span></span><br><span class="line">    <span class="keyword">if</span> int(t,<span class="number">16</span>) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = <span class="string">'%%0%dx'</span> % ml</span><br><span class="line">        C2 = form % (int(msg,<span class="number">16</span>) ^ int(t,<span class="number">16</span>))</span><br><span class="line">        <span class="comment"># print('C2 = %s'% C2)</span></span><br><span class="line">        <span class="comment"># print('%s%s%s'% (x2,msg,y2))</span></span><br><span class="line">        C3 = SM3.Hash_sm3(<span class="string">'%s%s%s'</span>% (x2,msg,y2),<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># print('C3 = %s' % C3)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'%s%s%s'</span> % (C1,C3,C2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密函数，C密文（16进制字符串），DA私钥</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Decrypt</span><span class="params">(C, DA, len_para)</span>:</span></span><br><span class="line">    len_2 = <span class="number">2</span> * len_para</span><br><span class="line">    len_3 = len_2 + <span class="number">64</span></span><br><span class="line">    C1 = C[<span class="number">0</span>:len_2]</span><br><span class="line">    C3 = C[len_2:len_3]</span><br><span class="line">    C2 = C[len_3:]</span><br><span class="line">    xy = kG(int(DA,<span class="number">16</span>), C1, len_para)</span><br><span class="line">    <span class="comment"># print('xy = %s' % xy)</span></span><br><span class="line">    x2 = xy[<span class="number">0</span>:len_para]</span><br><span class="line">    y2 = xy[len_para:len_2]</span><br><span class="line">    cl = len(C2)</span><br><span class="line">    <span class="comment"># print(cl)</span></span><br><span class="line">    t = SM3.KDF(xy, cl/<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># print('t = %s'%t)</span></span><br><span class="line">    <span class="keyword">if</span> int(t,<span class="number">16</span>) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = <span class="string">'%%0%dx'</span> % cl</span><br><span class="line">        M = form % (int(C2,<span class="number">16</span>) ^ int(t,<span class="number">16</span>))</span><br><span class="line">        <span class="comment"># print('M = %s' % M)</span></span><br><span class="line">        u = SM3.Hash_sm3(<span class="string">'%s%s%s'</span>% (x2,M,y2),<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span>  (u == C3):</span><br><span class="line">            <span class="keyword">return</span> M</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    len_para = int(Fp / <span class="number">4</span>)</span><br><span class="line">    <span class="comment"># print(len_para)</span></span><br><span class="line">    <span class="comment"># e = get_random_str(len_para)</span></span><br><span class="line">    e = SM3.byte2hex(SM3.str2byte(<span class="string">'we are student'</span>))</span><br><span class="line">    d = get_random_str(len_para)</span><br><span class="line">    k = get_random_str(len_para)</span><br><span class="line">    <span class="comment"># e = '656E6372797074696F6E207374616E64617264'</span></span><br><span class="line">    <span class="comment"># d = '3945208F7B2144B13F36E38AC6D39F95889393692860B51A42FB81EF4DF7C5B8'</span></span><br><span class="line">    <span class="comment"># d = '58892B807074F53FBF67288A1DFAA1AC313455FE60355AFD'</span></span><br><span class="line">    Pa = kG(int(d, <span class="number">16</span>), sm2_G, len_para)</span><br><span class="line">    Sig = Sign(e, d, k, len_para)</span><br><span class="line">    print(Verify(Sig, e, Pa, len_para))</span><br><span class="line">    <span class="comment"># print(Pa)</span></span><br><span class="line">    print(<span class="string">'M = %s'</span> % e)</span><br><span class="line">    C = Encrypt(e, Pa, len_para, <span class="number">1</span>)</span><br><span class="line">    print(<span class="string">'C = %s'</span> % C)</span><br><span class="line">    print(<span class="string">'Decrypt'</span>)</span><br><span class="line">    <span class="comment"># print(Decrypt(C, d, len_para))</span></span><br><span class="line">    print(Decrypt(C, d, len_para))</span><br></pre></td></tr></table></figure>

<p><img src="image-20200401190116841.png" alt="image-20200401190116841"></p>
<h2 id="实验总结-1"><a href="#实验总结-1" class="headerlink" title="实验总结"></a>实验总结</h2><p>SM2加密算法在Java中同样也可以基于使用BouncyCastle库实现。一般使用数字证书来标识身份，同时使用证书中公钥加密数据。SM2中有随机数的参与，所以每次即使相同的明文也会加密成不同的密文。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="http://www.jonllen.com/jonllen/work/164.aspx" target="_blank" rel="noopener">SM2非对称算法加解密</a></p>
<h1 id="实现SM2签名算法。给出“we-are-student”的签名。"><a href="#实现SM2签名算法。给出“we-are-student”的签名。" class="headerlink" title="实现SM2签名算法。给出“we are student”的签名。"></a>实现SM2签名算法。给出“we are student”的签名。</h1><h2 id="实验摘要-2"><a href="#实验摘要-2" class="headerlink" title="实验摘要"></a>实验摘要</h2><p>SM3数字签名部分和加解密部分相似</p>
<h2 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h2><p>此部分代码包含在上一个代码里，在此仅把关键部分摘出</p>
<h3 id="Python3-2"><a href="#Python3-2" class="headerlink" title="Python3"></a>Python3</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 验签函数，Sign签名r||s，E消息hash，PA公钥</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Verify</span><span class="params">(Sign, E, PA,len_para)</span>:</span></span><br><span class="line">    r = int(Sign[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">    s = int(Sign[len_para:<span class="number">2</span>*len_para], <span class="number">16</span>)</span><br><span class="line">    e = int(E, <span class="number">16</span>)</span><br><span class="line">    t = (r + s) % sm2_N</span><br><span class="line">    P1 = kG(s, sm2_G,len_para)</span><br><span class="line">    P2 = kG(t, PA,len_para)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> P1 == P2:</span><br><span class="line">        P1 = <span class="string">'%s%s'</span> % (P1, <span class="number">1</span>)</span><br><span class="line">        P1 = DoublePoint(P1,len_para)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        P1 = <span class="string">'%s%s'</span> % (P1, <span class="number">1</span>)</span><br><span class="line">        P1 = AddPoint(P1, P2,len_para)</span><br><span class="line">        P1 = ConvertJacb2Nor(P1,len_para)</span><br><span class="line"></span><br><span class="line">    x = int(P1[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> (r == ((e + x) % sm2_N))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 签名函数, E消息的hash，DA私钥，K随机数，均为16进制字符串</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Sign</span><span class="params">(E, DA, K,len_para)</span>:</span></span><br><span class="line">    e = int(E, <span class="number">16</span>)</span><br><span class="line">    d = int(DA, <span class="number">16</span>)</span><br><span class="line">    k = int(K, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    P1 = kG(k, sm2_G,len_para)</span><br><span class="line"></span><br><span class="line">    x = int(P1[<span class="number">0</span>:len_para], <span class="number">16</span>)</span><br><span class="line">    R = ((e + x) % sm2_N)</span><br><span class="line">    d_1 = pow(d+<span class="number">1</span>, sm2_N - <span class="number">2</span>, sm2_N)</span><br><span class="line">    S = (d_1*(k + R) - R) % sm2_N</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'%064x%064x'</span> % (R,S)</span><br></pre></td></tr></table></figure>

<p><img src="image-20200401190353179.png" alt="image-20200401190353179"></p>
<h2 id="实验总结-2"><a href="#实验总结-2" class="headerlink" title="实验总结"></a>实验总结</h2><p>对于要签名的信息e，这个是原始信息经过一定的处理通过散列函数得到的，散列算法用的是国密SM3算法</p>
<p><strong>参考文献：</strong></p>
<ol>
<li><a href="http://download.csdn.net/download/lict09/10131858" target="_blank" rel="noopener">国密SM3算法及基于SM3的密钥派生函数KDF</a></li>
<li><a href="http://download.csdn.net/download/lict09/10131863" target="_blank" rel="noopener">python3实现的国密SM2</a></li>
</ol>
<h1 id="实现SM3算法"><a href="#实现SM3算法" class="headerlink" title="实现SM3算法"></a>实现SM3算法</h1><h2 id="实验摘要-3"><a href="#实验摘要-3" class="headerlink" title="实验摘要"></a>实验摘要</h2><p>SM3主要部分包括：所需函数—布尔函数和置换函数，和参数（IV、T）。SM3对数据进行扩展和填充，然后迭代压缩生成Hash值。</p>
<h2 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h2><h3 id="Python3-3"><a href="#Python3-3" class="headerlink" title="Python3"></a>Python3</h3> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始值IV</span></span><br><span class="line">IV = <span class="string">'7380166f 4914b2b9 172442d7 da8a0600 a96f30bc 163138aa e38dee4d b0fb0e4e'</span></span><br><span class="line">IV = int(IV.replace(<span class="string">' '</span>, <span class="string">''</span>), <span class="number">16</span>)</span><br><span class="line"><span class="comment"># IV = 52242288850037289314637692563605787808083148960692295188198367823108413001294</span></span><br><span class="line"><span class="comment"># 接下来挨个取出来IV</span></span><br><span class="line">a = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">8</span>):</span><br><span class="line">    a.append(<span class="number">0</span>)</span><br><span class="line">    a[i] = (IV &gt;&gt; ((<span class="number">7</span> - i) * <span class="number">32</span>)) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">IV = a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印输出</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">out_hex</span><span class="params">(list1)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> list1:</span><br><span class="line">        print(<span class="string">"%08x"</span> % i)</span><br><span class="line">    print(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环左移</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotate_left</span><span class="params">(a, k)</span>:</span></span><br><span class="line">    k = k % <span class="number">32</span></span><br><span class="line">    <span class="keyword">return</span> ((a &lt;&lt; k) &amp; <span class="number">0xFFFFFFFF</span>) | ((a &amp; <span class="number">0xFFFFFFFF</span>) &gt;&gt; (<span class="number">32</span> - k))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常量T</span></span><br><span class="line">T_j = []</span><br><span class="line"><span class="comment"># 0&lt;= j &lt;= 15</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">16</span>):</span><br><span class="line">    T_j.append(<span class="number">0</span>)</span><br><span class="line">    T_j[i] = <span class="number">0x79cc4519</span></span><br><span class="line"><span class="comment"># 16&lt;= j &lt;= 63</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>, <span class="number">64</span>):</span><br><span class="line">    T_j.append(<span class="number">0</span>)</span><br><span class="line">    T_j[i] = <span class="number">0x7a879d8a</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 布尔函数FF_J，起混淆作用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FF_j</span><span class="params">(X, Y, Z, j)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt;= j &lt; <span class="number">16</span>:</span><br><span class="line">        ret = X ^ Y ^ Z</span><br><span class="line">    <span class="keyword">elif</span> <span class="number">16</span> &lt;= j &lt; <span class="number">64</span>:</span><br><span class="line">        ret = (X &amp; Y) | (X &amp; Z) | (Y &amp; Z)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 布尔函数GG_J，起混淆作用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GG_j</span><span class="params">(X, Y, Z, j)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt;= j &lt; <span class="number">16</span>:</span><br><span class="line">        ret = X ^ Y ^ Z</span><br><span class="line">    <span class="keyword">elif</span> <span class="number">16</span> &lt;= j &lt; <span class="number">64</span>:</span><br><span class="line">        <span class="comment"># ret = (X | Y) &amp; ((2 ** 32 - 1 - X) | Z)</span></span><br><span class="line">        ret = (X &amp; Y) | ((~ X) &amp; Z)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 置换函数P_0，起扩散作用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">P_0</span><span class="params">(X)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> X ^ (rotate_left(X, <span class="number">9</span>)) ^ (rotate_left(X, <span class="number">17</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 置换函数P_1，起扩散作用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">P_1</span><span class="params">(X)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> X ^ (rotate_left(X, <span class="number">15</span>)) ^ (rotate_left(X, <span class="number">23</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩函数CF</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CF</span><span class="params">(V_i, B_i)</span>:</span></span><br><span class="line">    <span class="comment"># 将消息分组按以下方法扩展生成132个字W_0,W_1...W_67,W_0',W_1'...W_63'</span></span><br><span class="line">    <span class="comment"># 将消息分组划分为16个字W_0,W_1...W_15</span></span><br><span class="line">    W = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        weight = <span class="number">0x1000000</span></span><br><span class="line">        data = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(i * <span class="number">4</span>,(i + <span class="number">1</span>) * <span class="number">4</span>):</span><br><span class="line">            data = data + B_i[k] * weight</span><br><span class="line">            weight = int(weight / <span class="number">0x100</span>)</span><br><span class="line">        W.append(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>, <span class="number">68</span>):</span><br><span class="line">        W.append(<span class="number">0</span>)</span><br><span class="line">        W[j] = P_1(W[j - <span class="number">16</span>] ^ W[j<span class="number">-9</span>] ^ (rotate_left(W[j - <span class="number">3</span>], <span class="number">15</span>))) ^ (rotate_left(W[j - <span class="number">13</span>], <span class="number">7</span>)) ^ W[j - <span class="number">6</span>]</span><br><span class="line">        <span class="comment"># str1 = "%08x" % W[j]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># W_j' = W_j ^ W_j+4</span></span><br><span class="line">    W_1 = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">64</span>):</span><br><span class="line">        W_1.append(<span class="number">0</span>)</span><br><span class="line">        W_1[j] = W[j] ^ W[j+<span class="number">4</span>]</span><br><span class="line">        <span class="comment"># str1 = "%08x" % W_1[j]</span></span><br><span class="line"></span><br><span class="line">    A, B, C, D, E, F, G, H = V_i</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    print "00",</span></span><br><span class="line"><span class="string">    out_hex([A, B, C, D, E, F, G, H])</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 压缩函数，令ABCDEFGH为字寄存器，SS1,SS2,TT1,TT2为中间变量，压缩函数V_i+1 = CF(V_(i), B_(i))</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">64</span>):</span><br><span class="line">        SS1 = rotate_left(((rotate_left(A, <span class="number">12</span>)) + E + (rotate_left(T_j[j], j))) &amp; <span class="number">0xFFFFFFFF</span>, <span class="number">7</span>)</span><br><span class="line">        SS2 = SS1 ^ (rotate_left(A, <span class="number">12</span>))</span><br><span class="line">        TT1 = (FF_j(A, B, C, j) + D + SS2 + W_1[j]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        TT2 = (GG_j(E, F, G, j) + H + SS1 + W[j]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        D = C</span><br><span class="line">        C = rotate_left(B, <span class="number">9</span>)</span><br><span class="line">        B = A</span><br><span class="line">        A = TT1</span><br><span class="line">        H = G</span><br><span class="line">        G = rotate_left(F, <span class="number">19</span>)</span><br><span class="line">        F = E</span><br><span class="line">        E = P_0(TT2)</span><br><span class="line"></span><br><span class="line">        A = A &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        B = B &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        C = C &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        D = D &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        E = E &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        F = F &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        G = G &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        H = H &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        str1 = "%02d" % j</span></span><br><span class="line"><span class="string">        if str1[0] == "0":</span></span><br><span class="line"><span class="string">            str1 = ' ' + str1[1:]</span></span><br><span class="line"><span class="string">        print str1,</span></span><br><span class="line"><span class="string">        out_hex([A, B, C, D, E, F, G, H])</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">    V_i_1 = []</span><br><span class="line">    V_i_1.append(A ^ V_i[<span class="number">0</span>])</span><br><span class="line">    V_i_1.append(B ^ V_i[<span class="number">1</span>])</span><br><span class="line">    V_i_1.append(C ^ V_i[<span class="number">2</span>])</span><br><span class="line">    V_i_1.append(D ^ V_i[<span class="number">3</span>])</span><br><span class="line">    V_i_1.append(E ^ V_i[<span class="number">4</span>])</span><br><span class="line">    V_i_1.append(F ^ V_i[<span class="number">5</span>])</span><br><span class="line">    V_i_1.append(G ^ V_i[<span class="number">6</span>])</span><br><span class="line">    V_i_1.append(H ^ V_i[<span class="number">7</span>])</span><br><span class="line">    <span class="keyword">return</span> V_i_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hash_msg</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="comment"># 将消息填充为512比特(64字节)的整数倍</span></span><br><span class="line">    len1 = len(msg)</span><br><span class="line">    reserve1 = len1 % <span class="number">64</span></span><br><span class="line">    <span class="comment"># 先添加一个1bit</span></span><br><span class="line">    msg.append(<span class="number">0x80</span>)</span><br><span class="line">    reserve1 = reserve1 + <span class="number">1</span></span><br><span class="line">    <span class="comment"># 56-64, add 64 byte</span></span><br><span class="line">    <span class="comment"># 即如果目前长度占用最后8个byte的表示长度的位置，则另外再增加64byte</span></span><br><span class="line">    range_end = <span class="number">56</span></span><br><span class="line">    <span class="keyword">if</span> reserve1 &gt; range_end:</span><br><span class="line">        range_end = range_end + <span class="number">64</span></span><br><span class="line">    <span class="comment"># 从新增的1到倒数第65bit全部填充0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(reserve1, range_end):</span><br><span class="line">        msg.append(<span class="number">0x00</span>)</span><br><span class="line"></span><br><span class="line">    bit_length = (len1) * <span class="number">8</span></span><br><span class="line">    bit_length_str = [bit_length % <span class="number">0x100</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">        bit_length = int(bit_length / <span class="number">0x100</span>)</span><br><span class="line">        bit_length_str.append(bit_length % <span class="number">0x100</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        msg.append(bit_length_str[<span class="number">7</span> - i])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># group_count = round(len(msg) / 64)</span></span><br><span class="line">    <span class="comment"># 组数</span></span><br><span class="line">    group_count = len(msg) // <span class="number">64</span></span><br><span class="line"></span><br><span class="line">    B = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, group_count):</span><br><span class="line">        B.append(msg[i * <span class="number">64</span>:(i + <span class="number">1</span>) * <span class="number">64</span>])</span><br><span class="line"></span><br><span class="line">    V = []</span><br><span class="line">    V.append(IV)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, group_count):</span><br><span class="line">        V.append(CF(V[i], B[i]))</span><br><span class="line"></span><br><span class="line">    y = V[i+<span class="number">1</span>]</span><br><span class="line">    result = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> y:</span><br><span class="line">        result = <span class="string">'%s%08x'</span> % (result, i)</span><br><span class="line">    <span class="comment"># 最后的结果</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串转换成byte数组</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2byte</span><span class="params">(msg)</span>:</span></span><br><span class="line">    ml = len(msg)</span><br><span class="line">    msg_byte = []</span><br><span class="line">    msg_bytearray = msg.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(ml):</span><br><span class="line">        <span class="comment"># msg_byte.append(ord(msg[i]))</span></span><br><span class="line">        msg_byte.append(msg_bytearray[i])</span><br><span class="line">    <span class="keyword">return</span> msg_byte</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 16进制字符串转换成byte数组</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hex2byte</span><span class="params">(msg)</span>:</span></span><br><span class="line">    ml = len(msg)</span><br><span class="line">    <span class="keyword">if</span> ml % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">        msg = <span class="string">'0'</span> + msg</span><br><span class="line">    ml = int(len(msg) / <span class="number">2</span>)</span><br><span class="line">    msg_byte = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(ml):</span><br><span class="line">        <span class="comment"># print(msg[i*2:i*2+2])</span></span><br><span class="line">        msg_byte.append(int(msg[i * <span class="number">2</span>:i * <span class="number">2</span> + <span class="number">2</span>], <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">return</span> msg_byte</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># byte数组转换成16进制字符串</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">byte2hex</span><span class="params">(msg)</span>:</span></span><br><span class="line">    ml = len(msg)</span><br><span class="line">    hexstr = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(ml):</span><br><span class="line">        hexstr = hexstr + (<span class="string">'%02x'</span> % msg[i])</span><br><span class="line">    <span class="keyword">return</span> hexstr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Hash_sm3</span><span class="params">(msg, Hexstr=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span>(Hexstr):</span><br><span class="line">        msg_byte = hex2byte(msg)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        msg_byte = str2byte(msg)</span><br><span class="line">    <span class="keyword">return</span> hash_msg(msg_byte)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">KDF</span><span class="params">(Z,klen)</span>:</span> <span class="comment"># Z为16进制表示的比特串（str），klen为密钥长度（单位byte）</span></span><br><span class="line">    klen = int(klen)</span><br><span class="line">    ct = <span class="number">0x00000001</span></span><br><span class="line">    <span class="comment"># ceil为向上取整函数</span></span><br><span class="line">    rcnt = ceil(klen / <span class="number">32</span>)</span><br><span class="line">    Zin = hex2byte(Z)</span><br><span class="line">    Ha = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(rcnt):</span><br><span class="line">        msg = Zin + hex2byte(<span class="string">'%08x'</span> % ct)</span><br><span class="line">        <span class="comment"># print(msg)</span></span><br><span class="line">        Ha = Ha + hash_msg(msg)</span><br><span class="line">        <span class="comment"># print(Ha)</span></span><br><span class="line">        ct += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> Ha[<span class="number">0</span>: klen * <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'liushengwen'</span>)</span><br><span class="line">    y = Hash_sm3(<span class="string">'liushengwen'</span>)</span><br><span class="line">    print(y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># # klen = 19</span></span><br><span class="line">    <span class="comment"># # print(KDF("57E7B63623FAE5F08CDA468E872A20AFA03DED41BF1403770E040DC83AF31A67991F2B01EBF9EFD8881F0A0493000603", klen))</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># m = 'You are so beautiful'</span></span><br><span class="line">    <span class="comment"># m = hex2byte(m)</span></span><br><span class="line">    <span class="comment"># m = byte2hex(m)</span></span><br><span class="line">    <span class="comment"># print(m)</span></span><br></pre></td></tr></table></figure>

<p><img src="image-20200401190423849.png" alt="image-20200401190423849"></p>
<h2 id="实验总结-3"><a href="#实验总结-3" class="headerlink" title="实验总结"></a>实验总结</h2><p>算法描述：</p>
<ol>
<li>填充对数据填充的目的是使数据在填充后长度的512的整数倍。</li>
<li>迭代压缩处理</li>
<li>消息扩展</li>
<li>压缩函数（SM3安全的关键）</li>
</ol>
<h2 id="参考文献-1"><a href="#参考文献-1" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="http://download.csdn.net/download/lict09/10131858" target="_blank" rel="noopener">国密SM3算法及基于SM3的密钥派生函数KDF</a></li>
<li><a href="http://download.csdn.net/download/lict09/10131863" target="_blank" rel="noopener">python3实现的国密SM2</a></li>
</ol>

    
  </div>

</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2017/12/29/通信原理复习整理/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2018/01/07/现代密码学复习整理/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              文章
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于我
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
